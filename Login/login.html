<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inicio de sesión</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Iconos -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=Gloock&display=swap" rel="stylesheet" />

  <!-- SweetAlert -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- CSS personalizado -->
  <link rel="stylesheet" href="/Login/login.css">
  <link rel="stylesheet" href="/Login/login_resp.css">

  <link rel="website icon" href="../Images/Icono_veganimo.svg">

  <!-- PHP personalizado -->
  <script src="/Login/login.php" defer></script>
  
</head>
<body class="custom-bg d-flex min-vh-100 px-3">

  <!-- Contenedor general -->
<!-- CONTENEDOR GENERAL SIMILAR AL SIGNUP -->
<div class="login-card">

  <!-- FORMULARIO A LA IZQUIERDA -->
  <div class="login-content">

    <div class="text-center mb-4">
      <div class="logo-container">
        <div class="img-fluid logo" alt="isotipo">
          <!-- TU SVG ORIGINAL -->
          <svg id="Capa_2" data-name="Capa 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 168.68 199.52">
            <g id="Veganimo">
              <g>
                <path class="cls-1" d="M86.29,80.26c-.7-.61-1.28-1.32-1.77-2.05,3.86,9,7.35,17.37,8.89,21.71l8.39-17.96c-5.41,2.01-11.23,2.03-15.51-1.7Z"/>
                <path class="cls-1" d="M136.3,0H32.38C14.5,0,0,14.49,0,32.38V167.13c0,17.89,14.5,32.39,32.38,32.39h103.92c17.88,0,32.38-14.5,32.38-32.39V32.38c0-17.89-14.5-32.38-32.38-32.38Zm6.77,33.9c-6.17-.63-10.49,1.22-14.22,4.34-3.91,3.28-5.37,7.22-6.64,10.77-2.46,6.91-3.56,14.68-6.72,21.31-1.54,3.22-4.54,6.39-8.17,8.8l-20.9,44.76h15.89c-1.85-10.13,1.45-20.96,9.71-28.35,7.33-6.55,16.95-8.94,25.92-7.28,1.27,1.45-6.95,10.87-10.25,13.82,3.3-2.95,13.58-10.07,14.89-8.63,.63,9.1-2.8,18.38-10.14,24.94-2.66,2.39-5.63,4.21-8.76,5.5h14.16c3.04,0,5.45,2.6,5.17,5.62-1.57,16.65-10.06,31.28-22.55,41.01-4.3,3.34-9.6,5.13-15.04,5.13-.31,0-.55,.25-.55,.55v2.33c0,1.71-1.39,3.1-3.1,3.1h-34.82c-1.71,0-3.1-1.39-3.1-3.1v-2.33c0-.31-.25-.55-.55-.55h-.25c-5.44,0-10.75-1.79-15.05-5.13-12.49-9.73-20.98-24.36-22.54-41.01-.29-3.02,2.13-5.62,5.16-5.62h23.36c-2.31-.91-4.47-2.3-6.33-4.18-4.77-4.83-6.3-11.64-4.62-17.74,6.13-1.59,12.9,.03,17.67,4.86,4.6,4.66,6.18,11.14,4.8,17.06h14.23L42.97,44.17c-4.22-9.35-8.99-14.02-14.29-14.02h-.45v-1.29h49.92v1.29h-.61c-4.52,0-7.51,1.17-8.98,3.53-1.48,2.36-1.23,5.64,.74,9.84,0,0,6.93,15.5,13.49,30.68,1.45,.76,5.37,.96,6.1,.91,1.77-.12,3.93-.58,5.38-1.45,3.79-2.3,6.64-7.11,7.97-10.94,1.54-4.33,2.59-9.32,4.44-13.83,2.15-5.32,5.27-10.6,10.29-14.42,5.17-4.09,13.11-6.26,20.38-4.16,2.31,.68,4.43,1.79,5.92,3.27l-.2,.32Z"/>
              </g>
            </g>
          </svg>
        </div>
      </div>
    </div>

    <h2 class="form-title text-center mb-2">Inicio de sesión</h2>
    <div class="separator mb-4"></div>

    <!-- TU FORMULARIO ORIGINAL -->
    <form id="loginForm">
      <div class="mb-3">
        <label for="email" class="form-label">Correo:</label>
        <input type="email" id="email" name="email" class="form-control input-border" placeholder="Ingrese su correo" required />
      </div>

      <div class="mb-4 position-relative">
        <label for="password" class="form-label">Contraseña:</label>
        <input type="password" id="password" name="password" class="form-control input-border" placeholder="Ingrese su contraseña" required />

        <span class="password-toggle">
          <i class="fas fa-eye eye-icon"></i>
        </span>
      </div>

      <div id="login-message" class="mb-3 text-center"></div>

      <div class="text-center">
        <button type="submit">Iniciar sesión</button>
      </div>
    </form>

    <div class="text-center mt-3">
      <a href="/Login/recuperar_correo/recuperar.html" class="text-muted small d-block">¿Has olvidado tu contraseña?</a>
      <a href="/Register/register.html" class="text-muted small text-crearc">Crea cuenta</a>
    </div>

  </div>

  <!-- IMAGEN DERECHA -->
  <div class="login-image-side">
    <img src="https://images.pexels.com/photos/2862154/pexels-photo-2862154.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" />
  </div>

</div>


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/Login/login.js"></script>


    <!-- script para mostrar/ocultar contraseña -->
    <script>
      const passwordInput = document.getElementById('password');
      const toggleIcon = document.querySelector('.eye-icon');
    
      toggleIcon.addEventListener('click', () => {
        const isPasswordVisible = passwordInput.type === 'text';
        passwordInput.type = isPasswordVisible ? 'password' : 'text';
        toggleIcon.classList.toggle('fa-eye-slash', isPasswordVisible); 
        toggleIcon.classList.toggle('fa-eye', !isPasswordVisible);      
      });
    </script>

<script>
 // Elimina los scripts existentes y reemplaza con este:
document.addEventListener('DOMContentLoaded', function() {
  // Configuración del toggle de contraseña
  toggleIcon.addEventListener('click', () => {
    const isPasswordVisible = passwordInput.type === 'text';
    passwordInput.type = isPasswordVisible ? 'password' : 'text';
   
  });

  // Manejo del formulario de login
  document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const messageDiv = document.getElementById('login-message');

    // Validación básica en el cliente
    if (!email || !password) {
      messageDiv.textContent = '⚠️ Por favor completa todos los campos';
      messageDiv.className = 'mb-3 text-center text-danger';
      return;
    }

    try {
      // En el manejo del formulario de login, dentro del try:
const response = await fetch('login.php', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: `email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`
});

const result = await response.json();

// Mostrar mensaje al usuario
messageDiv.textContent = result.message;
messageDiv.className = `mb-3 text-center ${result.success ? 'text-success' : 'text-danger'}`;

// Redirigir si es exitoso
  if (result.success) {
      // Guardar el nombre en localStorage antes de redirigir
      if (result.display_name) {
          localStorage.setItem('userDisplayName', result.display_name);
          localStorage.setItem('userFullName', result.full_name || ''); // Para depuración
      }
      
      // Redirigir a la página principal
      window.location.href = "/Pantalla_principal/index_pantalla_principal.html";
  }
    } catch (error) {
      messageDiv.textContent = '❌ Error de conexión con el servidor';
      messageDiv.className = 'mb-3 text-center text-danger';
      console.error('Error:', error);
    }
  });
});
  </script>
    
  
</body>
</html>